<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Reviews</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Simple fade-in animation for modals */
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.2s ease-out forwards;
        }
        /* Custom font for search icon */
        .font-mono {
            font-family: 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", monospace;
        }
    </style>
</head>
<body class="bg-gray-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- Hardcoded Book Data ---
        const hardcodedBooks = 
        [
            // -- 2025 Books --
            {title: "Winter World", author: "A.G. Riddle", series: "Long Winter Trilogy", genre: "Sci-Fi", rating: 3, dateFinished: "2025", pages: 470, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Empire of Silence", author: "Christopher Ruocchio", series: "Sun Eater", genre: "Sci-Fi", rating: 1, dateFinished: "2025", pages: 736, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "The Fifth Season", author: "N.K. Jemisin", series: "Broken Earth", genre: "Fantasy", rating: 2, dateFinished: "2025", pages: 512, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "The Threads of Then and Now", author: "Meagen Boulay", series: "Threads", genre: "Fantasy", rating: 5, dateFinished: "2025", pages: 383, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Concrete Island", author: "J. G. Ballard", genre: "Sci-Fi", rating: 2, dateFinished: "2025", pages: 176, category: "Fiction", format: "Audiobook", isBookClub: false, review: ""},
            {title: "Into Thin Air", author: "Jon Krakauer", genre: "Biography,Travel", rating: 4, dateFinished: "2025", pages: 332, category: "Non-Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "A Man Called Ove", author: "Fredrik Backman", genre: "Fiction", rating: 4, dateFinished: "2025", pages: 368, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "The Undead Fox of Deadwood Forest", author: "Aubrey Hartman", genre: "YoungAdult,Fantasy", rating: 5, dateFinished: "2025", pages: 320, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Persepolis Rising", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 4, dateFinished: "2025", pages: 560, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 7 },
            {title: "Tiamat's Wrath", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 4, dateFinished: "2025", pages: 576, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 8 },
            {title: "Leviathan Falls", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 5, dateFinished: "2025", pages: 560, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 9},
            {title: "Memory's Legion", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 4, dateFinished: "2025", pages: 450, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 10},
            // -- 2024 Books --
            {title: "Leviathan Wakes", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 592, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1},
            {title: "Caliban's War", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 624, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Abaddon's Gate", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 5, dateFinished: "2024", pages: 576, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 3},
            {title: "Cibola Burn", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 5, dateFinished: "2024", pages: 624, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 4 },
            {title: "Nemesis Games", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 5, dateFinished: "2024", pages: 624, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 5 },
            {title: "Babylon's Ashes", author: "James S.A. Corey", series: "The Expanse", genre: "Sci-Fi", rating: 5, dateFinished: "2024", pages: 576, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 6},
            {title: "Ark", author: "Veronica Roth", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 45, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Randomize", author: "Andy Weir", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 32, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Summer Frost", author: "Blake Crouch", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 85, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "Emergency Skin", author: "N.K. Jemisin", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 3, dateFinished: "2024", pages: 38, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 4 },
            {title: "You Have Arrived at Your Destination", author: "Amor Towles", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 2, dateFinished: "2024", pages: 54, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 5 },
            {title: "The Last Conversation", author: "Paul Tremblay", series: "Forward: Stories of Tomorrow", genre: "Sci-Fi", rating: 1, dateFinished: "2024", pages: 67, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 6 },
            {title: "Absolution", author: "Jeff Vandermeer", series: "Southern Reach", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 464, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 4 },
            {title: "The Sparrow", author: "Mary Doria Russell", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 517, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "The Count of Monte Cristo", author: "Alexandre Dumas", genre: "Classic", rating: 4, dateFinished: "2024", pages: 1138, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Blade Itself", author: "Joe Abercrombie", series: "The First Law Trilogy", genre: "Fantasy", rating: 4, dateFinished: "2024", pages: 560, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "The Forever War", author: "Joe Haldeman", series: "The Forever War", genre: "Sci-Fi", rating: 4, dateFinished: "2024", pages: 264, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Devolution", author: "Max Brooks", genre: "Thriller", rating: 4, dateFinished: "2024", pages: 288, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Termination Shock", author: "Neal Stephenson", genre: "Sci-Fi", rating: 3, dateFinished: "2024", pages: 720, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Gentleman In Moscow", author: "Amor Towles", genre: "Historical Fiction", rating: 3, dateFinished: "2024", pages: 465, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Egg and Other Stories", author: "Andy Weir", genre: "Sci-Fi", rating: 3, dateFinished: "2024", pages: 128, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Six of Crows", author: "Leigh Bardugo", series: "Six of Crows", genre: "Fantasy", rating: 3, dateFinished: "2024", pages: 495, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Crooked Kingdom", author: "Leigh Bardugo", series: "Six of Crows", genre: "Fantasy", rating: 3, dateFinished: "2024", pages: 578, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 2 },
            {title: "Sh≈çgun, Part One", author: "James Clavell", series: "The Asian Saga", genre: "Historical Fiction", rating: 3, dateFinished: "2024", pages: 699, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "The Land of Lost Things", author: "John Connolly", series: "The Book Of Lost Things", genre: "Coming of Age,Fantasy", rating: 3, dateFinished: "2024", pages: 364, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Oryx and Crake", author: "Margaret Atwood", series: "The MaddAddam Trilogy", genre: "Dystopian", rating: 3, dateFinished: "2024", pages: 389, category: "Fiction", format: "Audiobook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Vicious", author: "V.E. Schwab", series: "Villains", genre: "Fantasy,Superhero", rating: 2, dateFinished: "2024", pages: 480, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Vengeful", author: "V.E. Schwab", series: "Villains", genre: "Fantasy,Superhero", rating: 3, dateFinished: "2024", pages: 462, category: "Fiction", format: "Ebook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Mountain in the Sea", author: "Ray Nayler", genre: "Sci-Fi", rating: 2, dateFinished: "2024", pages: 464, category: "Fiction", format: "Ebook", isBookClub: true, review: "" },
            {title: "The Golem and the Jinni", author: "Helene Wecker", genre: "Fantasy", rating: 1, dateFinished: "2024", pages: 496, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "The Reddening", author: "Adam Nevill", genre: "Horror", rating: 1, dateFinished: "2024", pages: 419, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            // -- 2023 Books --
            {title: "Annihilation", author: "Jeff Vandermeer", series: "Southern Reach", genre: "Sci-Fi", rating: 4, dateFinished: "2023", pages: 224, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Authority", author: "Jeff VanderMeer", series: "Southern Reach", genre: "Sci-Fi", rating: 4, dateFinished: "2023", pages: 368, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Acceptance", author: "Jeff VanderMeer", series: "Southern Reach", genre: "Sci-Fi", rating: 5, dateFinished: "2023", pages: 368, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "A Study in Scarlet", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 4, dateFinished: "2023", pages: 174, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Sign of the Four", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 4, dateFinished: "2023", pages: 126, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "The Hound of the Baskervilles", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 5, dateFinished: "2023", pages: 188, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "The Valley of Fear", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 5, dateFinished: "2023", pages: 172, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 4 },
            {title: "The Adventures of Sherlock Holmes", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 5, dateFinished: "2023", pages: 104, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 5 },
            {title: "The Memoirs of Sherlock Holmes", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 5, dateFinished: "2023", pages: 194, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 6 },
            {title: "The Return of Sherlock Holmes", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 5, dateFinished: "2023", pages: 404, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 7 },
            {title: "His Last Bow", author: "Arthur Conan Doyle", series: "Sherlock Holmes", genre: "Mystery", rating: 4, dateFinished: "2023", pages: 183, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 8 },
            {title: "The Saturday Night Ghost Club", author: "Craig Davidson", genre: "Horror", rating: 5, dateFinished: "2023", pages: 224, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Stand", author: "Stephen King", genre: "Dystopian", rating: 5, dateFinished: "2023", pages: 1328, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Terror", author: "Dan Simmons", genre: "Thriller", rating: 5, dateFinished: "2023", pages: 784, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "World War Z", author: "Max Brooks", genre: "Horror", rating: 5, dateFinished: "2023", pages: 352, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "2001: a Space Odyssey", author: "Arthur C. Clarke", series: "Space Odyssey", genre: "Sci-Fi", rating: 4, dateFinished: "2023", pages: 256, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Circe", author: "Madeline Miller", genre: "Mythology", rating: 4, dateFinished: "2023", pages: 416, category: "Fiction", format: "Ebook", isBookClub: true, review: "" },
            {title: "The Hike", author: "Drew Magary", genre: "Fantasy", rating: 4, dateFinished: "2023", pages: 288, category: "Fiction", format: "Ebook", isBookClub: true, review: "" },
            {title: "The Postmortal", author: "Drew Magary", genre: "Dystopian", rating: 4, dateFinished: "2023", pages: 400, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "And Then I Woke Up", author: "Malcolm Devlin", genre: "Horror", rating: 3, dateFinished: "2023", pages: 166, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "Every Dead Thing", author: "John Connolly", series: "Charlie Parker", genre: "Thriller", rating: 3, dateFinished: "2023", pages: 512, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Quantum Radio", author: "A.G. Riddle", series: "Multiverse", genre: "Sci-Fi", rating: 3, dateFinished: "2023", pages: 512, category: "Fiction", format: "Ebook", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Graveyard Book", author: "Neil Gaiman", genre: "YoungAdult,Fantasy", rating: 3, dateFinished: "2023", pages: 368, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "The Haar", author: "David Sodergren", genre: "Horror", rating: 3, dateFinished: "2023", pages: 220, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "The House at the End of the World", author: "Dean Koontz", genre: "Sci-Fi", rating: 3, dateFinished: "2023", pages: 398, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "The Rover", author: "Drew Magary", genre: "Sci-Fi", rating: 3, dateFinished: "2023", pages: 23, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Song of Achilles", author: "Madeline Miller", genre: "Mythology", rating: 3, dateFinished: "2023", pages: 408, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "The Way of Shadows", author: "Brent Weeks", series: "Night Angel", genre: "Fantasy", rating: 3, dateFinished: "2023", pages: 645, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Cloud Atlas", author: "David Mitchell", genre: "Sci-Fi", rating: 2, dateFinished: "2023", pages: 509, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "Crooked House", author: "Agatha Christie", genre: "Mystery", rating: 2, dateFinished: "2023", pages: 256, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "Gideon the Ninth", author: "Tamsyn Muir", series: "The Locked Tomb", genre: "Fantasy", rating: 2, dateFinished: "2023", pages: 496, category: "Fiction", format: "Ebook", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "The Deep", author: "Nick Cutter", genre: "Horror", rating: 1, dateFinished: "2023", pages: 416, category: "Fiction", format: "Ebook", isBookClub: true, review: "" },
            // -- 2022 Books --
            {title: "Jurassic Park", author: "Michael Crichton", series: "Jurassic Park", genre: "Thriller", rating: 5, dateFinished: "2022", pages: 466, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Lost World", author: "Michael Crichton", series: "Jurassic Park", genre: "Thriller", rating: 4, dateFinished: "2022", pages: 448, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "And Then There Were None", author: "Agatha Christie", genre: "Mystery", rating: 5, dateFinished: "2022", pages: 300, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "Klara and the Sun", author: "Kazuo Ishiguro", genre: "Sci-Fi", rating: 5, dateFinished: "2022", pages: 320, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "Project Hail Mary", author: "Andy Weir", genre: "Sci-Fi", rating: 5, dateFinished: "2022", pages: 496, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "We Have Always Lived in the Castle", author: "Shirley Jackson", genre: "Gothic,Thriller", rating: 5, dateFinished: "2022", pages: 146, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "Furies of Calderon", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 5, dateFinished: "2022", pages: 688, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Academ's Fury", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 4, dateFinished: "2022", pages: 722, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Cursor's Fury", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 4, dateFinished: "2022", pages: 705, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "Captain's Fury", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 4, dateFinished: "2022", pages: 476, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 4 },
            {title: "Princeps' Fury", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 4, dateFinished: "2022", pages: 412, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 5 },
            {title: "First Lord's Fury", author: "Jim Butcher", series: "Codex Alera", genre: "Fantasy", rating: 4, dateFinished: "2022", pages: 705, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 6 },
            {title: "All the Pretty Horses", author: "Cormac McCarthy", series: "The Border Trilogy", genre: "Western", rating: 4, dateFinished: "2022", pages: 301, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Gulp: Adventures on the Alimentary Canal", author: "Mary Roach", genre: "Science", rating: 4, dateFinished: "2022", pages: 354, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Sphere", author: "Michael Crichton", genre: "Thriller", rating: 4, dateFinished: "2022", pages: 528, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Stranger", author: "Albert Camus", genre: "Classic", rating: 4, dateFinished: "2022", pages: 113, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "Final Spin", author: "Jocko Willink", genre: "Thriller", rating: 3, dateFinished: "2022", pages: 208, category: "Fiction", format: "Ebook", isBookClub: false, review: "" },
            {title: "Good Omens", author: "Terry Pratchett, Neil Gaiman", genre: "Humor/Fantasy", rating: 3, dateFinished: "2022", pages: 288, category: "Fiction", format: "Audiobook", isBookClub: true, review: "" },
            {title: "Nightfall and Other Stories", author: "Isaac Asimov", genre: "Sci-Fi", rating: 3, dateFinished: "2022", pages: 416, category: "Fiction", format: "Ebook", isBookClub: true, review: "" },
            {title: "The Troop", author: "Nick Cutter", genre: "Horror", rating: 3, dateFinished: "2022", pages: 384, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "Steelheart", author: "Brandon Sanderson", series: "The Reckoners", genre: "Fantasy,Superhero", rating: 2, dateFinished: "2022", pages: 432, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Broken Heart of Arelium", author: "Alex Robins", series: "War of the Twelve", genre: "Fantasy", rating: 2, dateFinished: "2022", pages: 306, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Eaters of the Dead", author: "Michael Crichton", genre: "Historical Fiction", rating: 2, dateFinished: "2022", pages: 208, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "20,000 Leagues Under the Sea", author: "Jules Verne", genre: "Classic", rating: 1, dateFinished: "2022", pages: 256, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "The Listeners", author: "James Gunn", genre: "Sci-Fi", rating: 1, dateFinished: "2022", pages: 277, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            // -- 2021 Books --
            {title: "Dune", author: "Frank Herbert", series: "Dune", genre: "Sci-Fi", rating: 5, dateFinished: "2021", pages: 704, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Hyperion", author: "Dan Simmons", series: "Hyperion Cantos", genre: "Sci-Fi", rating: 5, dateFinished: "2021", pages: 481, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Breath: The New Science of a Lost Art", author: "James Nestor", genre: "Science", rating: 5, dateFinished: "2021", pages: 304, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "I Am Legend", author: "Richard Matheson", genre: "Dystopian", rating: 5, dateFinished: "2021", pages: 104, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "No Country For Old Men", author: "Cormac McCarthy", genre: "Thriller", rating: 5, dateFinished: "2021", pages: 322, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Road", author: "Cormac McCarthy", genre: "Dystopian", rating: 5, dateFinished: "2021", pages: 324, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Blood Meridian", author: "Cormac McCarthy", genre: "Western", rating: 4, dateFinished: "2021", pages: 372, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Cryptonomicon", author: "Neal Stephenson", genre: "Thriller", rating: 4, dateFinished: "2021", pages: 1168, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Prey", author: "Michael Crichton", genre: "Thriller", rating: 4, dateFinished: "2021", pages: 528, category: "Fiction", format: "Physical", isBookClub: true, review: "" },
            {title: "The Phoenix Project", author: "Gene Kim", series: "The Phoenix Project", genre: "Business", rating: 3, dateFinished: "2021", pages: 537, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Snow Crash", author: "Neal Stephenson", genre: "Sci-Fi", rating: 3, dateFinished: "2021", pages: 480, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "America Before: The Key to Earth's Lost Civilization", author: "Graham Hancock", genre: "History", rating: 2, dateFinished: "2021", pages: 624, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Who Fears Death", author: "Nnedi Okorafor", genre: "Dystopian", rating: 2, dateFinished: "2021", pages: 401, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Yellow Wallpaper", author: "Charlotte Perkins Gilman", genre: "Classic", rating: 1, dateFinished: "2021", pages: 21, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            // -- 2020 Books --
            {title: "The Demon In The Freezer", author: "Richard Preston", series: "Dark Biology", genre: "Science,Biology", rating: 5, dateFinished: "2020", pages: 306, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Sandworm", author: "Andy Greenberg", genre: "Cyber", rating: 5, dateFinished: "2020", pages: 370, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The End Is Always Near", author: "Dan Carlin", genre: "History", rating: 5, dateFinished: "2020", pages: 293, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Book of Lost Things", author: "John Connolly", series: "The Book Of Lost Things", genre: "Coming of Age,Fantasy", rating: 4, dateFinished: "2020", pages: 352, category: "Fiction", format: "Physical", isBookClub: true, review: "", seriesOrder: 1 },
            {title: "Aurora", author: "Kim Stanley Robinson", genre: "Sci-Fi", rating: 4, dateFinished: "2020", pages: 512, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Black Elk", author: "Joe Jackson", genre: "Biography,History", rating: 4, dateFinished: "2020", pages: 830, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Exhalation: Stories", author: "Ted Chiang", genre: "Sci-Fi", rating: 4, dateFinished: "2020", pages: 362, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Raven Rock", author: "Garrett M. Graff", genre: "History", rating: 4, dateFinished: "2020", pages: 561, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Reamde", author: "Neal Stephenson", genre: "Thriller", rating: 4, dateFinished: "2020", pages: 1055, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Underland: A Deep Time Journey", author: "Robert Macfarlane", genre: "Science,Ecology", rating: 4, dateFinished: "2020", pages: 495, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Andromeda Evolution", author: "Michael Crichton", series: "The Andromeda Strain", genre: "Sci-Fi", rating: 3, dateFinished: "2020", pages: 383, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "All Systems Red", author: "Martha Wells", series: "Murderbot Diaries", genre: "Sci-Fi", rating: 2, dateFinished: "2020", pages: 156, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Starless Sea", author: "Erin Morgenstern", genre: "Fantasy", rating: 2, dateFinished: "2020", pages: 487, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            // -- Prior to 2020 --
            {title: "The Andromeda Strain", author: "Michael Crichton", series: "The Andromeda Strain", genre: "SciFi", rating: 5, dateFinished: "2019", pages: 384, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Three Body Problem", author: "Cixin Liu", series: "Three Body Problem", genre: "SciFi", rating: 5, dateFinished: "2019", pages: 400, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "The Dark Forest", author: "Cixin Liu", series: "Three Body Problem", genre: "SciFi", rating: 5, dateFinished: "2019", pages: 513, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Deaths End", author: "Cixin Liu", series: "Three Body Problem", genre: "SciFi", rating: 5, dateFinished: "2019", pages: 605, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "Artemis", author: "Andy Weir", series: "", genre: "SciFi", rating: 3, dateFinished: "2019", pages: 335, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Dichotomy of Leadership", author: "Jocko Willink", series: "", genre: "Business", rating: 3, dateFinished: "2019", pages: 311, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Astrophysics for People in a Hurry", author: "Neil de Grasse Tyson", series: "", genre: "Science", rating: 3, dateFinished: "2019", pages: 222, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Genghis: Birth of an Empire", author: "Conn Iggulden", series: "Conqueror", genre: "Historical Fiction", rating: 5, dateFinished: "2018", pages: 403, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 1 },
            {title: "Genghis: Bones of the Hills", author: "Conn Iggulden", series: "Conqueror", genre: "Historical Fiction", rating: 5, dateFinished: "2018", pages: 434, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 3 },
            {title: "Genghis: Lords of the Bow", author: "Conn Iggulden", series: "Conqueror", genre: "Historical Fiction", rating: 5, dateFinished: "2018", pages: 547, category: "Fiction", format: "Physical", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "Dispatches from Pluto", author: "Richard Grant", series: "", genre: "Travel", rating: 4, dateFinished: "2018", pages: 322, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Killer Angels", author: "Michael Shaara", series: "Civil War Trilogy", genre: "Historical Fiction", rating: 5, dateFinished: "2016", pages: 466, category: "Fiction", format: "Audiobook", isBookClub: false, review: "", seriesOrder: 2 },
            {title: "The Art of Intrusion", author: "Kevin Mitnick", series: "", genre: "Cyber", rating: 2, dateFinished: "2016", pages: 290, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Field of Fight: How We Can Win the Global War Against Radical Islam and Its Allies", author: "Michael T. Flynn", series: "", genre: "Political", rating: 2, dateFinished: "2016", pages: 209, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "How to Fail at Almost Everything and Still Win Big: Kind of the Story of My Life", author: "Scott Adams", series: "", genre: "Self-Help", rating: 2, dateFinished: "2016", pages: 302, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Isaac's Storm", author: "Erik Larson", series: "", genre: "Historical Fiction", rating: 5, dateFinished: "2015", pages: 338, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Art of Deception", author: "Kevin Mitnick", series: "", genre: "Cyber", rating: 3, dateFinished: "2015", pages: 355, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The House on the Borderland", author: "William Hope Hodgson", series: "", genre: "Horror", rating: 4, dateFinished: "2015", pages: 192, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The River of Doubt", author: "Candice Millard", series: "", genre: "Historical Fiction", rating: 4, dateFinished: "2014", pages: 434, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Ghost in the Wires", author: "Kevin Mitnick", series: "", genre: "Cyber", rating: 4, dateFinished: "2014", pages: 433, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Midnight Rising", author: "Tony Horwitz", series: "", genre: "Historical Fiction", rating: 5, dateFinished: "2014", pages: 382, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "The Martian", author: "Andy Weir", series: "", genre: "SciFi", rating: 5, dateFinished: "2013", pages: 385, category: "Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "AWOL on the Appalachian Trail", author: "David Miller", series: "", genre: "Travel", rating: 3, dateFinished: "2013", pages: 347, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Flyboys: A True Story of Courage", author: "James Bradley", series: "", genre: "Military", rating: 4, dateFinished: "2013", pages: 562, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "A Walk for Sunshine", author: "Jeff Alt", series: "", genre: "Travel", rating: 2, dateFinished: "2013", pages: 357, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Digging For The Truth", author: "Josh Bernstein", series: "", genre: "Archeology", rating: 2, dateFinished: "2013", pages: 208, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "What the Dog Saw: And Other Adventures", author: "Malcolm Gladwell", series: "", genre: "Essays", rating: 2, dateFinished: "2013", pages: 433, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Monuments Men", author: "Robert M. Edsel", series: "", genre: "Military", rating: 3, dateFinished: "2013", pages: 468, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Death of a Salesman", author: "Arthur Miller", series: "", genre: "", rating: 5, dateFinished: "2012", pages: 139, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "A Walk in the Woods: Rediscovering America on the Appalachian Trail", author: "Bill Bryson", series: "", genre: "Travel", rating: 5, dateFinished: "2012", pages: 276, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "In a Sunburned Country", author: "Bill Bryson", series: "", genre: "Travel", rating: 5, dateFinished: "2012", pages: 352, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Siddhartha", author: "Hermann Hesse", series: "", genre: "", rating: 4, dateFinished: "2012", pages: 160, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Lone Survivor", author: "Marcus Luttrell", series: "", genre: "Memoir, War", rating: 3, dateFinished: "2012", pages: 392, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Frankenstein", author: "Mary Shelley", series: "", genre: "", rating: 4, dateFinished: "2012", pages: 288, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Devil in the White City", author: "Erik Larson", series: "", genre: "Historical Fiction", rating: 3, dateFinished: "2011", pages: 447, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Long Way Gone: Memoirs of a Boy Soldier", author: "Ismael Beah", series: "", genre: "Memoir, War", rating: 5, dateFinished: "2011", pages: 229, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Of Mice and Men", author: "John Steinbeck", series: "", genre: "", rating: 4, dateFinished: "2011", pages: 107, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Adventures of Huckleberry Finn", author: "Mark Twain", series: "", genre: "", rating: 3, dateFinished: "2011", pages: 224, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Scarlet Letter", author: "Nathaniel Hawthorne", series: "", genre: "", rating: 1, dateFinished: "2011", pages: 192, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Tortilla Curtain", author: "T.C. Boyle", series: "", genre: "", rating: 2, dateFinished: "2011", pages: 375, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "A Short History of Nearly Everything", author: "Bill Bryson", series: "", genre: "Science", rating: 5, dateFinished: "2010", pages: 544, category: "Non-Fiction", format: "Audiobook", isBookClub: false, review: "" },
            {title: "Night", author: "Elie Wiesel", series: "", genre: "", rating: 5, dateFinished: "2010", pages: 120, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "The Black Hole War", author: "Leonard Susskind", series: "", genre: "Astrophysics", rating: 2, dateFinished: "2010", pages: 480, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Physics of the Future", author: "Michio Kaku", series: "", genre: "Science", rating: 2, dateFinished: "2010", pages: 480, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Lord of the Flies", author: "William Golding", series: "", genre: "", rating: 5, dateFinished: "2010", pages: 224, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Things Fall Apart", author: "Chinua Achebe", series: "", genre: "", rating: 2, dateFinished: "2009", pages: 209, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "To Kill a Mockingbird", author: "Harper Lee", series: "", genre: "", rating: 3, dateFinished: "2009", pages: 331, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Miracle in the Andes", author: "Nando Parrado", series: "", genre: "Memoir, Survival", rating: 5, dateFinished: "2009", pages: 304, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Fahrenheit 451", author: "Ray Bradbury", series: "", genre: "", rating: 5, dateFinished: "2009", pages: 249, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Water For Elephants", author: "Sara Gruen", series: "", genre: "Historical Fiction, Romance", rating: 4, dateFinished: "2009", pages: 448, category: "Fiction", format: "Physical", isBookClub: false, review: "" },
            {title: "Worldwalk", author: "Steven M. Newman", series: "", genre: "Travel", rating: 3, dateFinished: "2009", pages: 527, category: "Non-Fiction", format: "Physical", isBookClub: false, review: "" }
        ];

        // --- SVG Icon Components ---
        const ArrowUpDown = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/></svg>
        );
        const BookIcon = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
        );
        const PageIcon = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const CalendarIcon = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
        );
        const StarIcon = (props) => (
            <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        );
        const UsersIcon = (props) => (
             <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        );


        // --- Helper Components ---
        const colorPalette = [
            '#ef4444', '#f97316', '#f59e0b', '#eab308', '#84cc16', '#22c55e', 
            '#10b981', '#14b8a6', '#06b6d4', '#0ea5e9', '#3b82f6', '#6366f1', 
            '#8b5cf6', '#a855f7', '#d946ef', '#ec4899', '#f43f5e'
        ];
        const genreColorMap = {};
        let lastColorIndex = -1;

        const getGenreColor = (genre) => {
            const lowerGenre = genre?.toLowerCase().trim() || 'default';
            if (genreColorMap[lowerGenre]) {
                return genreColorMap[lowerGenre];
            }
            let newColorIndex;
            do {
                newColorIndex = Math.floor(Math.random() * colorPalette.length);
            } while (newColorIndex === lastColorIndex);
            
            lastColorIndex = newColorIndex;
            const randomColor = colorPalette[newColorIndex];
            genreColorMap[lowerGenre] = randomColor;
            return randomColor;
        };
        
        const renderGenreBubbles = (genre) => {
            if (!genre) return null;
            const genres = genre.split(',').map(g => g.trim());
            return genres.map((g, index) => (
                <span key={index} style={{backgroundColor: getGenreColor(g), color: '#fff'}} className={`mr-1 mt-1 px-2 inline-flex text-xs leading-5 font-semibold rounded-full`}>{g}</span>
            ));
        };

        const getRatingColorClasses = (rating) => {
            const numericRating = parseInt(rating, 10);
            switch (numericRating) {
                case 1: return 'text-red-700 fill-red-700';
                case 2: return 'text-red-500 fill-red-500';
                case 3: return 'text-orange-500 fill-orange-500';
                case 4: return 'text-amber-400 fill-amber-400';
                case 5: return 'text-yellow-200 fill-yellow-200';
                default: return 'text-gray-400';
            }
        };

        const StarRating = ({ rating }) => {
            const numericRating = parseInt(rating, 10);
            const colorClasses = getRatingColorClasses(numericRating);
            if (isNaN(numericRating)) {
                return <span className="text-sm text-gray-400">{rating}</span>;
            }
            return (
                <div className="flex items-center">
                    {[1, 2, 3, 4, 5].map((star) => (
                        <StarIcon
                            key={star}
                            className={`w-5 h-5 ${numericRating >= star ? colorClasses : 'text-gray-600'}`}
                        />
                    ))}
                </div>
            );
        };

        const Modal = ({ children, isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4 animate-fade-in" onClick={onClose}>
                    <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <main className="p-6 overflow-y-auto rounded-2xl">{children}</main>
                    </div>
                </div>
            );
        };

        // --- Chart Components ---
        const PieChart = ({ data, labels, title, colors }) => {
            const chartRef = useRef(null);
            useEffect(() => {
                if (!chartRef.current) return;
                const ctx = chartRef.current.getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderColor: '#4a5568',
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top', labels: { color: '#d1d5db' } },
                            title: { display: true, text: title, color: '#d1d5db', font: { size: 16 } }
                        }
                    }
                });
                return () => chart.destroy();
            }, [data, labels, colors]);
            return <canvas ref={chartRef}></canvas>;
        };
        
        const LineChart = ({ data, labels, title }) => {
            const chartRef = useRef(null);
            useEffect(() => {
                if (!chartRef.current) return;
                const ctx = chartRef.current.getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Pages Read',
                            data: data,
                            fill: false,
                            borderColor: '#3b82f6',
                            tension: 0.1
                        }]
                    },
                    options: {
                       responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: title, color: '#d1d5db', font: { size: 16 } }
                        },
                        scales: {
                            x: { ticks: { color: '#d1d5db' }, grid: { color: '#2d3748' } },
                            y: { ticks: { color: '#d1d5db' }, grid: { color: '#4a5568' } }
                        }
                    }
                });
                return () => chart.destroy();
            }, [data, labels]);
            return <canvas ref={chartRef}></canvas>;
        };

        // --- Metrics Components ---
        const MetricCard = ({ icon, label, value, onClick }) => (
            <div className={`bg-gray-800 p-4 rounded-xl flex items-center gap-4 ${onClick ? 'cursor-pointer hover:bg-gray-700' : ''}`} onClick={onClick}>
                <div className="bg-gray-700 p-3 rounded-lg">{icon}</div>
                <div>
                    <div className="text-sm text-gray-400">{label}</div>
                    <div className="text-2xl font-bold text-white">{value}</div>
                </div>
            </div>
        );

        const MetricsDashboard = ({ metrics, onBookClubClick, onCategoryClick }) => {
            const formatColorMap = {
                'Audiobook': '#E6521F', 
                'Physical': '#FB9E3A',  
                'Ebook': '#FCEF91',   
                'Unknown': '#9ca3af' 
            };
            const formatLabels = Object.keys(metrics.formatCounts);
            const formatPieColors = formatLabels.map(label => formatColorMap[label] || formatColorMap['Unknown']);
            const genrePieColors = ['#03045e', '#0077b6', '#00b4d8', '#90e0ef', '#caf0f8'];

            return (
                <div className="mb-8 space-y-8">
                    <div>
                        <h2 className="text-2xl font-bold text-white mb-4">All-Time Stats</h2>
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                            <MetricCard icon={<BookIcon className="w-6 h-6 text-sky-400" />} label="Total Books" value={metrics.totalBooks.toLocaleString()} />
                            <MetricCard icon={<BookIcon className="w-6 h-6 text-amber-400" />} label="Fiction" value={metrics.fictionCount} onClick={() => onCategoryClick('Fiction')} />
                            <MetricCard icon={<BookIcon className="w-6 h-6 text-violet-400" />} label="Non-Fiction" value={metrics.nonFictionCount} onClick={() => onCategoryClick('Non-Fiction')} />
                            <MetricCard icon={<UsersIcon className="w-6 h-6 text-rose-400" />} label="Book Club" value={metrics.bookClubCount} onClick={onBookClubClick} />
                            <MetricCard icon={<PageIcon className="w-6 h-6 text-lime-400" />} label="Total Pages" value={metrics.totalPages.toLocaleString()} />
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="bg-gray-800 p-4 rounded-xl"><PieChart data={Object.values(metrics.genreCounts)} labels={Object.keys(metrics.genreCounts)} title="Genre Distribution" colors={genrePieColors} /></div>
                        <div className="bg-gray-800 p-4 rounded-xl"><PieChart data={Object.values(metrics.formatCounts)} labels={formatLabels} title="Format Breakdown" colors={formatPieColors} /></div>
                    </div>
                    
                     <div className="grid grid-cols-1">
                        <div className="bg-gray-800 p-4 rounded-xl"><LineChart data={metrics.pagesByYear.data} labels={metrics.pagesByYear.labels} title="Pages Read By Year" /></div>
                    </div>

                    <div>
                        <h2 className="text-2xl font-bold text-white mt-8 mb-4">By Year</h2>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {metrics.byYear.map(yearStats => (
                                <div key={yearStats.year} className="bg-gray-800 p-4 rounded-xl">
                                    <h3 className="text-xl font-bold text-white mb-3 flex items-center gap-2"><CalendarIcon className="w-5 h-5 text-gray-400" />{yearStats.year}</h3>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between"><span className="text-gray-400">Books Read:</span><span className="font-semibold text-white">{yearStats.bookCount}</span></div>
                                        <div className="flex justify-between"><span className="text-gray-400">Pages Read:</span><span className="font-semibold text-white">{yearStats.pageCount.toLocaleString()}</span></div>
                                        <div className="flex justify-between"><span className="text-gray-400">Avg. Rating:</span><span className="font-semibold text-white">{yearStats.averageRating.toFixed(2)}</span></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // --- Main App Component ---
        function App() {
            const [books] = useState(hardcodedBooks.map((book, index) => ({ ...book, id: index })));
            const [searchTerm, setSearchTerm] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: 'dateFinished', direction: 'descending' });
            const [selectedBook, setSelectedBook] = useState(null);
            const [view, setView] = useState('metrics'); // 'metrics' or 'library'
            
            const metrics = useMemo(() => {
                const yearlyData = {};
                const formatCounts = {};
                const genreCounts = {};
                let fictionCount = 0;
                let nonFictionCount = 0;
                let bookClubCount = 0;
                let totalPages = 0;
                let totalBooks = 0;

                books.forEach(book => {
                    // Overall counts
                    totalPages += book.pages || 0;
                    totalBooks++;
                    if (book.category === 'Fiction') fictionCount++;
                    if (book.category === 'Non-Fiction') nonFictionCount++;
                    if (book.isBookClub) bookClubCount++;
                    
                    // Format counts
                    const format = book.format || 'Unknown';
                    formatCounts[format] = (formatCounts[format] || 0) + 1;

                    // Genre counts
                    if(book.genre) {
                        book.genre.split(',').forEach(g => {
                            const trimmedGenre = g.trim();
                            genreCounts[trimmedGenre] = (genreCounts[trimmedGenre] || 0) + 1;
                        });
                    }

                    // Yearly data
                    const year = book.dateFinished?.substring(0, 4);
                    if (year && !isNaN(year)) {
                        if (!yearlyData[year]) {
                            yearlyData[year] = { bookCount: 0, pageCount: 0, ratingSum: 0, ratedBooks: 0 };
                        }
                        yearlyData[year].bookCount++;
                        yearlyData[year].pageCount += book.pages || 0;
                        const rating = parseInt(book.rating, 10);
                        if (!isNaN(rating)) {
                            yearlyData[year].ratingSum += rating;
                            yearlyData[year].ratedBooks++;
                        }
                    }
                });

                const byYear = Object.keys(yearlyData).map(year => ({
                    year,
                    bookCount: yearlyData[year].bookCount,
                    pageCount: yearlyData[year].pageCount,
                    averageRating: yearlyData[year].ratedBooks > 0 ? yearlyData[year].ratingSum / yearlyData[year].ratedBooks : 0
                })).sort((a, b) => b.year - a.year);
                
                const sortedGenres = Object.entries(genreCounts).sort(([,a],[,b]) => b-a).slice(0, 5);
                const topGenres = Object.fromEntries(sortedGenres);
                
                const pagesByYearLabels = byYear.map(y => y.year).reverse();
                const pagesByYearData = byYear.map(y => y.pageCount).reverse();

                return { 
                    totalBooks, totalPages, byYear, fictionCount, nonFictionCount, bookClubCount,
                    formatCounts, genreCounts: topGenres,
                    pagesByYear: { labels: pagesByYearLabels, data: pagesByYearData }
                };
            }, [books]);

            const sortedAndFilteredBooks = useMemo(() => {
                let filtered = [...books];
                if (searchTerm) {
                    const lowercasedTerm = searchTerm.toLowerCase();

                    if (lowercasedTerm === 'book club') {
                        filtered = books.filter(book => book.isBookClub);
                    } else if (lowercasedTerm === 'fiction' || lowercasedTerm === 'non-fiction') {
                        filtered = books.filter(book => book.category?.toLowerCase() === lowercasedTerm);
                    } else {
                        filtered = books.filter(book =>
                            book.title?.toLowerCase().includes(lowercasedTerm) ||
                            book.author?.toLowerCase().includes(lowercasedTerm) ||
                            book.series?.toLowerCase().includes(lowercasedTerm) ||
                            book.genre?.toLowerCase().includes(lowercasedTerm) ||
                            (book.dateFinished && book.dateFinished.toString().includes(lowercasedTerm))
                        );
                    }
                }
                if (sortConfig.key) {
                    filtered.sort((a, b) => {
                        if (sortConfig.key === 'series') {
                            const seriesCompare = (a.series || '').localeCompare(b.series || '');
                            if (seriesCompare !== 0) return seriesCompare * (sortConfig.direction === 'ascending' ? 1 : -1);
                            const orderCompare = (a.seriesOrder || 0) - (b.seriesOrder || 0);
                            if (orderCompare !== 0) return orderCompare;
                            return a.title.localeCompare(b.title);
                        }
                        const aValue = a[sortConfig.key];
                        const bValue = b[sortConfig.key];
                        if (aValue < bValue) return sortConfig.direction === 'ascending' ? -1 : 1;
                        if (aValue > bValue) return sortConfig.direction === 'ascending' ? 1 : -1;
                        return 0;
                    });
                }
                return filtered;
            }, [books, searchTerm, sortConfig]);

            const handleSort = (key) => {
                let direction = 'ascending';
                if (sortConfig.key === key && sortConfig.direction === 'ascending') {
                    direction = 'descending';
                }
                setSortConfig({ key, direction });
            };
            
            const handleBookClubFilter = () => {
                setSearchTerm('book club');
                setView('library');
            };

            const handleCategoryFilter = (category) => {
                setSearchTerm(category.toLowerCase());
                setView('library');
            };

            const SortableHeader = ({ label, columnKey }) => (
                <th className="p-3 text-left text-sm font-bold text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-700" onClick={() => handleSort(columnKey)}>
                    <div className="flex items-center">
                        <span>{label}</span>
                        {sortConfig.key === columnKey && <ArrowUpDown className="w-4 h-4 ml-2" />}
                    </div>
                </th>
            );

            const getButtonClass = (buttonView) => {
                return view === buttonView
                    ? 'bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600 py-2 px-4 rounded-lg';
            };

            return (
                <div className="bg-gray-900 text-gray-100 min-h-screen font-sans p-4 sm:p-6 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        <header className="mb-6">
                            <div className="flex flex-col sm:flex-row justify-between items-start gap-4">
                                <div>
                                    <h1 className="text-4xl font-bold text-white tracking-tight">Book Reviews</h1>
                                    <p className="text-gray-400 mt-1">
                                        <a href="https://brendanhiggins.dev" target="_blank" rel="noopener noreferrer" className="hover:text-sky-300">Brendan Higgins</a>
                                    </p>
                                </div>
                                <div className="flex space-x-2 bg-gray-800 p-1 rounded-lg">
                                    <button onClick={() => setView('metrics')} className={getButtonClass('metrics')}>
                                        Metrics
                                    </button>
                                    <button onClick={() => setView('library')} className={getButtonClass('library')}>
                                        Library
                                    </button>
                                </div>
                            </div>
                        </header>
                        
                        {view === 'metrics' && <MetricsDashboard metrics={metrics} onBookClubClick={handleBookClubFilter} onCategoryClick={handleCategoryFilter} />}

                        {view === 'library' && (
                            <>
                                <div className="mb-4">
                                    <input
                                        type="text"
                                        placeholder="Search by title, author, series, genre, or year..."
                                        className="w-full p-3 bg-gray-800 border-2 border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 font-mono"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <div className="bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-700">
                                            <thead className="bg-gray-800">
                                                <tr>
                                                    <SortableHeader label="Title" columnKey="title" />
                                                    <SortableHeader label="Series" columnKey="series" />
                                                    <SortableHeader label="Author" columnKey="author" />
                                                    <SortableHeader label="Rating" columnKey="rating" />
                                                    <SortableHeader label="Genre" columnKey="genre" />
                                                    <SortableHeader label="Finished" columnKey="dateFinished" />
                                                </tr>
                                            </thead>
                                            <tbody className="bg-gray-800 divide-y divide-gray-700">
                                                {sortedAndFilteredBooks.length > 0 ? (
                                                    sortedAndFilteredBooks.map(book => {
                                                        const titleColorClass = book.category === 'Fiction' ? 'text-amber-400' : 'text-violet-400';
                                                        return (
                                                            <tr key={book.id} className="hover:bg-gray-700/50 transition-colors duration-150">
                                                                <td className="p-4 whitespace-nowrap">
                                                                    <div className={`font-medium cursor-pointer ${titleColorClass} hover:opacity-80 flex items-center gap-2`} onClick={() => setSelectedBook(book)}>
                                                                        <span>{book.title}</span>
                                                                        {book.isBookClub && <UsersIcon className="w-4 h-4 text-rose-400 flex-shrink-0" title="Book Club Pick" />}
                                                                    </div>
                                                                </td>
                                                                <td className="p-4 whitespace-nowrap text-sm text-gray-400">{book.series}</td>
                                                                <td className="p-4 whitespace-nowrap text-gray-300">{book.author}</td>
                                                                <td className="p-4 whitespace-nowrap"><StarRating rating={book.rating} /></td>
                                                                <td className="p-4 whitespace-nowrap"><div className="flex flex-wrap">{renderGenreBubbles(book.genre)}</div></td>
                                                                <td className="p-4 whitespace-nowrap text-gray-300">{book.dateFinished ? book.dateFinished.substring(0, 4) : 'N/A'}</td>
                                                            </tr>
                                                        )
                                                    })
                                                ) : (
                                                    <tr><td colSpan="6" className="text-center p-8 text-gray-400">No books found for your search term.</td></tr>
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                    <BookDetailModal book={selectedBook} isOpen={!!selectedBook} onClose={() => setSelectedBook(null)} />
                </div>
            );
        }

        function BookDetailModal({ book, isOpen, onClose }) {
            if (!book) return null;
            return (
                <Modal isOpen={isOpen} onClose={onClose}>
                    <div className="text-gray-300 space-y-4">
                        <h2 className="text-3xl font-bold text-sky-300 flex items-center gap-3">
                            <span>{book.title}</span>
                            {book.isBookClub && <UsersIcon className="w-6 h-6 text-rose-400 flex-shrink-0" title="Book Club Pick" />}
                        </h2>
                        <p className="text-lg text-gray-400">by <span className="italic">{book.author}</span></p>
                        {book.series && <p className="text-md text-gray-400 mt-1"><span className="font-bold">Series:</span> {book.series} (Book {book.seriesOrder})</p>}
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 border-t border-gray-700 pt-4">
                            <div className="flex items-center gap-2"><span className="font-bold text-gray-400">Rating:</span><StarRating rating={book.rating} /></div>
                            <div className="flex items-center gap-2"><span className="font-bold text-gray-400">Category:</span><span>{book.category}</span></div>
                            <div className="flex items-center gap-2"><span className="font-bold text-gray-400">Format:</span><span>{book.format}</span></div>
                            <div className="flex items-center gap-2"><span className="font-bold text-gray-400">Pages:</span><span>{book.pages || 'N/A'}</span></div>
                            <div className="flex items-center gap-2"><span className="font-bold text-gray-400">Finished:</span><span>{book.dateFinished ? book.dateFinished.substring(0, 4) : 'N/A'}</span></div>
                            <div className="flex items-center gap-2 flex-wrap md:col-span-2"><span className="font-bold text-gray-400">Genre:</span>{renderGenreBubbles(book.genre)}</div>
                        </div>
                        <div className="prose prose-invert prose-lg max-w-none mt-4 bg-gray-900/50 p-4 rounded-lg">
                            <h4 className="font-bold text-white">Review</h4>
                            <p>{book.review || "No review written yet."}</p>
                        </div>
                        <div className="flex justify-end gap-4 pt-4">
                            <button type="button" onClick={onClose} className="py-2 px-4 bg-teal-600 hover:bg-teal-500 rounded-lg font-semibold transition-colors">Close</button>
                        </div>
                    </div>
                </Modal>
            );
        }

        // --- Mount the React App ---
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

</body>
</html>
